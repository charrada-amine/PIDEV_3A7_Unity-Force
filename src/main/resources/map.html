<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        #map {
            height: 400px;
            width: 600px;
            background: #f8f9fa;
        }
        .loading {
            text-align: center;
            padding: 180px 0;
            color: #6c757d;
        }
    </style>
</head>
<body>
<div id="map">
    <p class="loading">Chargement de la carte...</p>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    let map;
    let zones = [];

    function initMap() {
        if (map) return;

        map = L.map('map', {
            preferCanvas: true,
            zoomControl: true,
            attributionControl: false
        }).setView([36.8, 10.2], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        L.control.zoom({ position: 'topright' }).addTo(map);
        console.log("Carte initialisée");
    }

    function loadZonesFromDB(zonesDB) {
        if (!map) return;

        // Effacer les zones existantes
        zones.forEach(zone => map.removeLayer(zone));
        zones = [];

        // Ajouter les nouvelles zones
        zonesDB.forEach(zone => {
            addZone(zone.lat, zone.lng, zone.surface, zone.nom);
        });
    }

    function addZone(lat, lng, surface, nom) {
        if (!map) return;

        let radius = Math.sqrt(surface / Math.PI);
        let circle = L.circle([lat, lng], {
            radius: radius,
            color: '#ff5733',
            fillColor: '#ff5733',
            fillOpacity: 0.5
        }).addTo(map);

        circle.bindPopup(`<b>${nom}</b><br>Surface: ${surface} m²`);
        zones.push(circle);
    }

    setTimeout(initMap, 500);
</script>
</body>
</html>